CREATE DATABASE HotelManagement;
USE HotelManagement;


CREATE TABLE Hotel (
    HotelNo INT PRIMARY KEY,
    Name VARCHAR(100),
    City VARCHAR(50)
);


CREATE TABLE Room (
    RoomNo INT,
    HotelNo INT,
    Type VARCHAR(50),
    Price DECIMAL(10, 2),
    PRIMARY KEY (RoomNo, HotelNo),
    FOREIGN KEY (HotelNo) REFERENCES Hotel(HotelNo)
);


CREATE TABLE Booking (
    BookingID INT AUTO_INCREMENT PRIMARY KEY,
    HotelNo INT,
    GuestNo INT,
    DateFrom DATE,
    DateTo DATE,
    RoomNo INT,
    FOREIGN KEY (HotelNo) REFERENCES Hotel(HotelNo),
    FOREIGN KEY (RoomNo, HotelNo) REFERENCES Room(RoomNo, HotelNo)
);


CREATE TABLE Guest (
    GuestNo INT PRIMARY KEY,
    GuestName VARCHAR(100),
    GuestAddress VARCHAR(255)
);


-- Insert into Hotel

INSERT INTO Hotel (HotelNo, Name, City) VALUES 
(1, 'Grosvenor Hotel', 'London'),
(2, 'Hilton', 'New York'),
(3, 'Marriott', 'Paris');

-- Insert into Room

INSERT INTO Room (RoomNo, HotelNo, Type, Price) VALUES 
(101, 1, 'Single', 100),
(102, 1, 'Double', 150),
(201, 2, 'Single', 120),
(202, 2, 'Suite', 300),
(301, 3, 'Double', 200);

-- Insert into Guest

INSERT INTO Guest (GuestNo, GuestName, GuestAddress) VALUES 
(1, 'John Doe', '123 Elm Street'),
(2, 'Jane Smith', '456 Oak Avenue'),
(3, 'Mary Johnson', '789 Maple Drive');

-- Insert into Booking

INSERT INTO Booking (HotelNo, GuestNo, DateFrom, DateTo, RoomNo) VALUES 
(1, 1, '2024-11-01', '2024-11-05', 101),
(1, 2, '2024-11-02', NULL, 102),
(2, 3, '2024-11-03', '2024-11-06', 201);


SELECT * FROM Hotel;


SELECT * FROM Hotel
WHERE City = 'London';


SELECT Guest.GuestNo, Guest.GuestName, Guest.GuestAddress
FROM Guest
JOIN Booking ON Guest.GuestNo = Booking.GuestNo
JOIN Hotel ON Booking.HotelNo = Hotel.HotelNo
WHERE Hotel.Name = 'Grosvenor Hotel'
AND CURRENT_DATE BETWEEN Booking.DateFrom AND Booking.DateTo;



SELECT Guest.GuestName, Guest.GuestAddress
FROM Guest
JOIN Booking ON Guest.GuestNo = Booking.GuestNo
JOIN Hotel ON Booking.HotelNo = Hotel.HotelNo
WHERE Hotel.City = 'London'
ORDER BY Guest.GuestName ASC;



SELECT * FROM Booking
WHERE DateTo IS NULL;


SELECT COUNT(*) AS HotelCount
FROM Hotel;


SELECT Room.RoomNo, Room.Type, Room.Price
FROM Room
JOIN Hotel ON Room.HotelNo = Hotel.HotelNo
LEFT JOIN Booking ON Room.RoomNo = Booking.RoomNo AND Hotel.HotelNo = Booking.HotelNo
WHERE Hotel.Name = 'Grosvenor Hotel'
AND (Booking.RoomNo IS NULL OR CURRENT_DATE < Booking.DateFrom OR CURRENT_DATE > Booking.DateTo);



SELECT Hotel.Name, SUM(Room.Price) AS LostIncome
FROM Room
JOIN Hotel ON Room.HotelNo = Hotel.HotelNo
LEFT JOIN Booking ON Room.RoomNo = Booking.RoomNo AND Room.HotelNo = Booking.HotelNo
WHERE Booking.RoomNo IS NULL 
   OR CURRENT_DATE < Booking.DateFrom 
   OR CURRENT_DATE > Booking.DateTo
GROUP BY Hotel.Name;


CREATE INDEX idx_roomno ON Room(RoomNo);


EXPLAIN ANALYZE

SELECT * FROM Room WHERE RoomNo = 101;

CREATE VIEW GuestBookings AS
SELECT Guest.GuestName, Guest.GuestAddress, Hotel.Name AS HotelName, Room.RoomNo, Room.Type, Booking.DateFrom, Booking.DateTo
FROM Guest
JOIN Booking ON Guest.GuestNo = Booking.GuestNo
JOIN Hotel ON Booking.HotelNo = Hotel.HotelNo
JOIN Room ON Booking.RoomNo = Room.RoomNo;

SELECT * FROM GuestBookings WHERE HotelName = 'Grosvenor Hotel';
